<!DOCTYPE HTML>
<html>
	<head>
        <script src="https://maps.googleapis.com/maps/api/js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <link rel="stylesheet" href="../static/bootstrap-3.3.5-dist/css/bootstrap.css">
        <!-- <script>
            var x = document.getElementById("coords");
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } else {
                    x.innerHTML = "Geolocation is not supported by this browser.";
                }
            }
            function showPosition(position) {
                x.innerHTML = "Latitude: " + position.coords.latitude + 
                "<br>Longitude: " + position.coords.longitude; 
            }
        </script> -->
        <title>Food Truck Tracker</title>
        <style>
            #map-canvas {
                width: 500px;
                height: 400px;
                
            }
        </style>
	</head>
	<body>
        <div id="coords"></div>
        <div id="map-canvas"></div>
        <script>
            var x = document.getElementById("coords");
            var lat = 0
            var long = 0

            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } else {
                    x.innerHTML = "Geolocation is not supported by this browser.";
                }
            }
            function showPosition(position) {
                x.innerHTML = "Latitude: " + position.coords.latitude + 
                "<br>Longitude: " + position.coords.longitude; 
                lat= position.coords.latitude;
                long = position.coords.longitude;
            }
            getLocation()
            var myMap;
            function initialize() {
                //var position = navigator.geolocation.getCurrentPosition()
                var mapOptions = {   
                    zoom: 8,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    zoom:18
                }
                myMap = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
                
                var initialLocation = null;
                if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                        myMap.setCenter(initialLocation);
                        var marker = new google.maps.Marker({
                            position: initialLocation,
                            map: myMap
                            //label: "Hello world!"
                        });
                    });

                } 
                  
                console.log(initialLocation);
                google.maps.event.addDomListener(window, 'load', initialize);
            }
            
             $(document).ready(function() {
                alert('lel')
                var request = $.ajax({
                    type: "POST",
                    url: "/truck_array",
                    data: {"name":""}, // if you wanted to specifiy what list then pass an actual name
                    dataType: "html"
                });

                request.done(function(JSON_array_string) {
                    //alert(JSON_array);
                    array_data = JSON.parse(JSON_array_string)

                    for(i=0; i<array_data.length; i++)
                    {
                        alert(array_data[i]["food_truck_name"])
                    }

                    //from here you have your array to play with
                    for(i=0;i<array_data.length;i++)
                    {
                        var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(array_data[i]['x'], array_data[i]['y']),
                            map: myMap,
                            title: 'sdhfaioha'
                        });
                        var contentString = '<div id="content">'+
                            '<div id="siteNotice">'+
                            '</div>'+
                            '<h1 id="firstHeading" class="firstHeading">' + array_data[i]['food_truck_name'] + '</h1>'+
                            '<div id="bodyContent">'+
                            array_data[i]['description'] 
                            '</div>';    
                        var infoWindow = new google.maps.InfoWindow({
                            content: contentString
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            infoWindow.open(map,marker);
                        });
                    }
                });
            });
            google.maps.event.addDomListener(window, 'load', initialize);
        </script>
	</body>
</html>